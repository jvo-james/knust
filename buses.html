<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Vitra – KNUST Shuttle Tracker</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"  />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen/Control.FullScreen.css" />
 <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
  <style>
   :root {
  --primary:   #006233;
  --secondary: #372d2f; 
  --accent:    #ffd700;
  --primary-dark: #0056b3;  
  --light-bg: #f5fcff;
  --white: #ffffff;
  --dark-text: #222222;
  --muted-text: #666666;
  --radius: 12px;
  --gap: 20px;
  --transition: 0.3s ease;
  --shadow-light: 0 4px 16px rgba(0, 0, 0, 0.1);
  --shadow-dark: 0 8px 24px rgba(0, 0, 0, 0.15);
  --font-sans: 'Poppins', sans-serif;
  --font-alt: 'Montserrat', sans-serif;
}

*,
*::before,
*::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-sans);
  background: var(--light-bg);
  color: var(--dark-text);
  line-height: 1.6;
  overflow-x: hidden;
}

.app-header {
  position: sticky;
  top: 0;
  width: 100%;
  background: var(--secondary);
  color: var(--white);
  z-index: 1000;
  box-shadow: var(--shadow-light);
}
.header-inner {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem var(--gap);
}
.logo {
  width: 50px;
  height: 50px;
}
.app-title {
  font-family: var(--font-alt);
  font-size: 1.8rem;
  font-weight: 700;
  display: flex;
  align-items: center;
}
.app-title i {
  margin-right: 0.5rem;
  color: var(--accent);
}
.header-nav {
  display: flex;
  align-items: center;
}
.nav-btn {
  background: none;
  border: none;
  color: var(--white);
  font-size: 1rem;
  margin-left: 1rem;
  padding: 0.5rem;
  cursor: pointer;
  transition: color var(--transition), background var(--transition);
  border-radius: var(--radius);
}
.nav-btn:hover,
.nav-btn.active {
  background: rgba(255,255,255,0.1);
  color: var(--accent);
}
.hamburger {
  display: none;
  background: none;
  border: none;
  color: var(--white);
  font-size: 1.8rem;
  cursor: pointer;
}
.mobile-sidebar {
  position: fixed;
  top: 0;
  transform: translateX(-100%);
  width: 260px;
  height: 100%;
  background: var(--secondary);
  padding: 2rem 1rem;
  box-shadow: var(--shadow-dark);
 transition: transform var(--transition);
  z-index: 1100;
}
.mobile-sidebar .close-sidebar {
  background: none;
  border: none;
  color: var(--white);
  font-size: 1.2rem;
  margin-bottom: 2rem;
  cursor: pointer;
}
.mobile-sidebar .nav-btn {
  display: block;
  width: 100%;
  text-align: left;
  margin-bottom: 1rem;
}
 .mobile-sidebar.open {
  transform: translateX(0);
 }

    .hero-section {
  position: relative;
  height: 80vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.hero-background img {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: brightness(0.6);
}
.hero-overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.3);
}
.hero-content {
  position: relative;
  text-align: center;
  color: var(--white);
  max-width: 800px;
  padding: 0 var(--gap);
}
.hero-title {
  font-family: var(--font-alt);
  font-size: 3rem;
  font-weight: 700;
  margin-bottom: 1rem;
  white-space: nowrap;
  overflow: hidden;
  border-right: 3px solid var(--accent);
}
.hero-subtitle {
  font-size: 1.25rem;
  margin-bottom: 2rem;
}
.hero-buttons button {
  margin: 0 0.5rem;
}
.bus-animations {
  position: absolute;
  bottom: 10%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 2rem;
}
.bus-animation {
  font-size: 2rem;
  opacity: 0.8;
}
@keyframes busMove {
  0% { transform: translateX(-100px) scale(0.8); opacity: 0; }
  50% { opacity: 1; }
  100% { transform: translateX(100px) scale(1); opacity: 0; }
}
.animate-bus {
  animation: busMove 4s var(--transition) infinite;
}
 .hero-section {
  perspective: 1000px;
 }
.hero-background img {
 transform: translateZ(-100px) scale(1.1);  }
    .bus-animation {
 transform-origin: center center;
 }

    .container {
  max-width: 1200px;
  margin: -10vh auto 2rem;
  padding: 0 var(--gap);
}
.section {
  margin: 4rem 0;
}
.section h2 {
  font-family: var(--font-alt);
  font-size: 1.6rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  color: var(--secondary);
}
.section h2 i {
  margin-right: 0.5rem;
  color: var(--accent);
}


    .map-container {
  height: 350px;
  width: 100%;
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 1rem;
  box-shadow: var(--shadow-dark);
 background: #e5e3df;
}
.live-table-container {
  overflow-x: auto;
}
.live-table {
  width: 100%;
  border-collapse: collapse;
  box-shadow: var(--shadow-light);
}
.live-table th,
.live-table td {
  padding: 0.75rem 1rem;
  text-align: left;
}
.live-table th {
  background: var(--secondary);
  color: var(--white);
  position: sticky;
  top: 0;
}
.live-table tr:nth-child(even) {
  background: #fafafa;
}
.live-table td {
  border-bottom: 1px solid #eee;
}

    .booking-section form {
  background: var(--white);
  padding: 2rem;
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
}
.form-row {
  display: flex;
  gap: var(--gap);
  flex-wrap: wrap;
}
.form-group {
  flex: 1;
  min-width: 200px;
  display: flex;
  flex-direction: column;
  margin-bottom: 1rem;
}
.form-group label {
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: var(--secondary);
}
.select,
input[type="date"] {
  padding: 0.75rem;
  border: 1px solid #ccc;
  border-radius: var(--radius);
  font-size: 1rem;
  transition: border var(--transition);
}
.select:focus,
input:focus {
  outline: none;
  border-color: var(--primary);
}


.history-buttons {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin: 2rem 0;
}
.history-buttons .btn-secondary {
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius);
  transition: background var(--transition), color var(--transition);
}
.history-buttons .btn-secondary.active,
.history-buttons .btn-secondary:hover {
  background: var(--secondary);
  color: var(--white);
}


.grid-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: var(--gap);
}
.card {
  position: relative;
  background: var(--white);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow-light);
  cursor: pointer;
  transition: transform var(--transition), box-shadow var(--transition);
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-dark);
}
.card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
}
.card-body {
  padding: 1rem;
  text-align: center;
  font-weight: 600;
  color: var(--secondary);
}
.quick-modal .modal {
  max-width: 320px;
  text-align: center;
}


.modal-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  backdrop-filter: blur(4px);
  pointer-events: auto;
}

.modal-overlay.open {
  display: flex;
}
.modal {
  background: var(--white);
  border-radius: var(--radius);
  max-width: 500px;
  width: 90%;
  padding: 2rem;
  box-shadow: var(--shadow-dark);
  position: relative;
  transition: transform var(--transition);
}
.close-btn {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: var(--muted-text);
  transition: color var(--transition);
}
.close-btn:hover {
  color: var(--dark-text);
}

.history-modal h3 {
  margin-bottom: 1rem;
  color: var(--secondary);
}
.history-tabs {
  display: flex;
  justify-content: space-around;
  margin-bottom: 1.5rem;
}
.history-tabs .tab {
  background: var(--light-bg);
  border: none;
  padding: 0.5rem 1rem;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background var(--transition), color var(--transition);
}
.history-tabs .tab.active,
.history-tabs .tab:hover {
  background: var(--secondary);
  color: var(--white);
}
.ride-list {
  max-height: 250px;
  overflow-y: auto;
  list-style: none;
  padding-left: 0;
  margin-bottom: 1rem;
}
.ride-list li {
  padding: 0.75rem;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  transition: background var(--transition);
}
.ride-list li:hover {
  background: var(--light-bg);
}
.ride-detail {
  background: #fafafa;
  padding: 1rem;
  border-radius: var(--radius);
  text-align: center;
}
.ride-detail h4 {
  margin-bottom: 0.5rem;
  color: var(--secondary);
}


.support-chat-btn {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  background: var(--accent);
  color: var(--white);
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  font-size: 1.5rem;
  cursor: pointer;
  box-shadow: var(--shadow-dark);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform var(--transition);
}
.support-chat-btn:hover {
  transform: scale(1.1);
}


.app-footer {
  text-align: center;
  padding: 2rem var(--gap);
  background: #f0f0f0;
  color: #555;
  font-size: 0.9rem;
}
.app-footer i {
  color: var(--accent);
  margin-left: 0.5rem;
}


@media (max-width: 768px) {
  .header-inner { flex-wrap: wrap; text-align: center; }
  .desktop-only { display: none; }
  .hamburger { display: block; }
  .form-row { flex-direction: column; }
  .hero-title { font-size: 2.5rem; }
}
@media (max-width: 480px) {
  :root { --gap: 12px; }
  .hero-title { font-size: 2rem; }
  .hero-subtitle { font-size: 1rem; }
  .btn-primary, .btn-secondary { width: 100%; }
}


    .accordion .accordion-item { margin-bottom:1rem; }
    .accordion-header {
      width:100%; background:var(--white); border:1px solid #ccc;
      border-radius:var(--radius); padding:.75rem 1rem;
      display:flex; align-items:center; justify-content:space-between;
      cursor:pointer; transition:background var(--transition);
    }
    .accordion-body { display:none; padding:1rem; border-left:4px solid var(--accent); }

   

    .app-footer { text-align:center; padding:1.5rem var(--gap); background:#f0f0f0; color:#555; font-size:.9rem; }
    .app-footer i { color:var(--accent); margin-left:.5rem; }

    @media(max-width:768px){
      .header-inner { flex-wrap:wrap; text-align:center; }
      .desktop-only { display:none; }
      .hamburger { display:block; }
      .form-row { flex-direction:column; }
      .hero { flex-direction:column; text-align:center; }
      .hero-content, .hero-image { max-width:100%; }
    }
    @media(max-width:480px){
      :root{--gap:12px;}
      .app-title{font-size:1.2rem;}
      .btn-primary, .btn-secondary{width:100%;}
    }

     #map { will-change: transform; }

 
    
.hero-section {
  position: relative;
  height: 90vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  animation: fadeInHero 1s ease-out;
}

.hero-background img {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: brightness(0.5);
}

.hero-overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);
}

.hero-content {
  position: relative;
  z-index: 2;
  text-align: center;
  color: var(--white);
  max-width: 800px;
  padding: 0 var(--gap);
  opacity: 0;
  animation: slideInUp 1s ease-out forwards 0.5s;
}

.hero-title {
  font-family: var(--font-alt);
  font-size: 3.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  white-space: nowrap;
  overflow: hidden;
  border-right: 3px solid var(--accent);
  width: 0;
  animation:
    typing 3s steps(30, end) forwards,
    blink-caret .75s step-end infinite 3s;
}

.hero-subtitle {
  font-size: 1.125rem;
  margin-bottom: 2rem;
  opacity: 0;
  animation: fadeInHero 1s ease-out forwards 2.5s;
}

 .hero-buttons .btn-primary,
     .hero-buttons .btn-secondary {
     display: inline-block;
      padding: 0.75rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      text-decoration: none;
      border-radius: var(--radius);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      transition: background var(--transition), transform var(--transition), box-shadow var(--transition);
     }
     .hero-buttons .btn-primary {
       background: var(--primary);
       color: var(--white);
     }
    .hero-buttons .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
     .hero-buttons .btn-secondary {
      background: var(--accent);
      color: var(--white);
     }
    .hero-buttons .btn-secondary:hover {
      background: #e65550;
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

.bus-animation {
  font-size: 2rem;
  opacity: 0.8;
 animation:
    busMove     6s ease-in-out infinite,
    float       3s ease-in-out infinite,
    spin        8s linear infinite;
}
.bus-animations .bus-1 { animation-delay: 0s; }
.bus-animations .bus-2 { animation-delay: 0.5s; }
.bus-animations .bus-3 {
  animation: flyAcross 4s linear infinite;
}

@keyframes flyAcross {
  0%   { transform: translateX(-150vw) scale(1) rotate(0deg); opacity: 1; }
  80%  { opacity: 1; }
 100% { transform: translateX(150vw) scale(1) rotate(0deg); opacity: 0; }
}
    @keyframes spin {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
.bus-icon {
  background: var(--accent);
  color: var(--white);
  border-radius: 50%;
  padding: 4px;
  font-size: 1rem;
  box-shadow: var(--shadow-dark);
  transition: transform 0.3s ease;
}
.bus-icon:hover {
  transform: scale(1.3);
  z-index: 999;
}

     .quick-modal p {
     margin-bottom: 1.5rem;      
    }
    .quick-modal .btn-primary {
      text-decoration: none;     
      display: inline-block;
    }
    @keyframes fadeInHero {
  from { opacity: 0; }
  to   { opacity: 1; }
}
@keyframes slideInUp {
  from { transform: translateY(30px); opacity: 0; }
  to   { transform: translateY(0);  opacity: 1; }
}
@keyframes typing {
  from { width: 0; }
  to   { width: 100%; }
}
@keyframes blink-caret {
  50% { border-color: transparent; }
}
@keyframes busMove {
  0%   { transform: translateX(-100px) scale(0.8); opacity: 0; }
  50%  { opacity: 1; }
  100% { transform: translateX(100px) scale(1); opacity: 0; }
}

@media (max-width: 768px) {
  .hero-title { font-size: 2.8rem; }
  .hero-subtitle { font-size: 1rem; }
  .hero-buttons button { width: 100%; margin: 0.5rem 0; }
}

@media (max-width: 480px) {
  .hero-title { font-size: 2rem; }
  .hero-subtitle { font-size: 0.9rem; }
  .hero-buttons button { padding: 0.75rem 1.5rem; font-size: 0.9rem; }
}

.live-search {
  position: relative;
  max-width: 400px;
  margin: 1rem auto 1.5rem;
}
.live-search input {
  width: 100%;
  padding: 0.75rem 2.5rem 0.75rem 1rem;
  border-radius: var(--radius);
  border: 1px solid #ccc;
  font-size: 1rem;
  transition: border var(--transition);
}
.live-search input:focus {
  border-color: var(--primary);
  outline: none;
}
.search-icon {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: #888;
  pointer-events: none;
}

.live-cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: var(--gap);
}
.shuttle-card {
  position: relative;
  background: var(--white);
  border-radius: var(--radius);
  padding: 1rem;
  box-shadow: var(--shadow-light);
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInUp 0.6s ease-out forwards;
  transition: transform var(--transition), box-shadow var(--transition);
}
    .shuttle-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-dark);
}

.occupancy {
  display: flex;
  align-items: center;
  margin: 0.5rem 0;
}
.occupancy span {
  font-size: 0.875rem;
  color: var(--muted-text);
}
.occ-bar {
  flex: 1;
  height: 8px;
  background: #eee;
  border-radius: 4px;
  overflow: hidden;
  margin-left: 0.5rem;
}
.occ-fill {
  height: 100%;
  background: var(--accent);
  transition: width var(--transition);
}

.shuttle-card h3 {
  margin-bottom: 0.5rem;
}
.shuttle-card p {
  margin-bottom: 0.5rem;
}
.progress-bar {
  background: #eee;
  border-radius: var(--radius);
  height: 6px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: var(--primary);
  transition: width var(--transition);
}

.leaflet-interactive.pulse-marker {
  animation: pulse 1.8s ease-out infinite;
}
@keyframes pulse {
  0%   { r: 6; opacity: 0.6; }
  50%  { r: 12; opacity: 0.2; }
  100% { r: 6; opacity: 0.6; }
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@media (max-width: 768px) {
  .live-cards { grid-template-columns: 1fr; }
}

    .pulse-marker {
  animation: pulse 1.8s ease-out infinite;
}
@keyframes pulse {
  0%   { r: 6; opacity: 0.6; }
  50%  { r: 12; opacity: 0.2; }
  100% { r: 6; opacity: 0.6; }
}

.booking-section form {
  background: var(--white);
  padding: 2.5rem;
  border-radius: var(--radius);
  box-shadow: var(--shadow-dark);
  transition: box-shadow var(--transition);
}
.booking-section form:hover {
  box-shadow: var(--shadow-light);
}
.booking-section .form-group label {
  color: var(--secondary);
  margin-bottom: 0.5rem;
  font-weight: 600;
}
.booking-section .select,
.booking-section input[type="date"] {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid #ccc;
  border-radius: var(--radius);
  font-size: 1rem;
  transition: border var(--transition), box-shadow var(--transition);
}
.booking-section .select:focus,
.booking-section input[type="date"]:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 4px rgba(255,111,97,0.2);
}
.booking-section button[type="submit"] {
  margin-top: 1.5rem;
  padding: 0.75rem 2rem;
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--white);
  background: var(--accent);
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}
.booking-section button[type="submit"]:hover {
  background: #e65550;
  transform: translateY(-2px);
}

.booking-confirm-modal {
  max-width: 380px;
  text-align: center;
}
.booking-confirm-modal h3 {
  color: var(--secondary);
  margin-bottom: 0.5rem;
}
.booking-confirm-modal p {
  margin: 0.75rem 0;
  color: var(--dark-text);
}
.booking-confirm-modal .qr-container {
  margin: 1rem 0;
  display: flex;
  justify-content: center;
}
.booking-confirm-modal canvas {
  width: 180px;
  height: 180px;
  border: 4px solid var(--secondary);
  border-radius: 12px;
}
.booking-confirm-modal .qr-note {
  font-size: 0.9rem;
  color: var(--muted-text);
  margin-bottom: 1.5rem;
}

.history-modal {
  max-width: 500px;
  padding: 2rem;
}
.history-modal h3 {
  font-family: var(--font-alt);
  font-size: 1.5rem;
  margin-bottom: 1rem;
  color: var(--secondary);
}
.history-tabs {
  display: flex;
  justify-content: space-around;
  margin-bottom: 1.5rem;
}
.history-tabs .tab {
  flex: 1;
  background: var(--light-bg);
  border: none;
  padding: 0.75rem;
  margin: 0 0.25rem;
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  transition: background var(--transition), color var(--transition);
}
.history-tabs .tab.active {
  background: var(--accent);
  color: var(--white);
}
.ride-list {
  max-height: 250px;
  overflow-y: auto;
  list-style: none;
  margin: 0;
  padding: 0;
}
.ride-list li {
  padding: 0.75rem 1rem;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  transition: background var(--transition);
}
.ride-list li:hover,
.ride-list li.active {
  background: var(--light-bg);
}
.ride-detail {
  background: #fafafa;
  padding: 1rem;
  border-radius: var(--radius);
  margin-top: 1rem;
}
.ride-detail h4 {
  margin-bottom: 0.5rem;
  color: var(--secondary);
}
.ride-detail p {
  margin: 0.25rem 0;
}
#ridesBtnLive,
#ridesBtnHeader,
#ridesBtnMobile {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  font-weight: 600;
  border-radius: var(--radius);
  border: none;
  cursor: pointer;
  transition: background var(--transition), color var(--transition);
}
#ridesBtnHeader { margin-left: 1rem; }
#ridesBtnHeader:hover,
#ridesBtnMobile:hover,
#ridesBtnLive:hover {
  background: var(--accent);
  color: var(--white);
}

.support-chat-btn {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  background: var(--accent);
  color: var(--white);
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  font-size: 1.5rem;
  cursor: pointer;
  box-shadow: var(--shadow-dark);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform var(--transition), background var(--transition);
}
.support-chat-btn:hover {
  transform: scale(1.1);
  background: #e65550;
}

.support-modal {
  max-width: 360px;
  text-align: center;
  padding: 2rem 1.5rem;
}
.support-modal h3 {
  font-family: var(--font-alt);
  color: var(--secondary);
  margin-bottom: 1rem;
}
.support-modal p {
  margin-bottom: 1rem;
  color: var(--dark-text);
}
.support-options {
  list-style: none;
  padding: 0;
  margin: 1rem 0;
  text-align: left;
}
.support-options li {
  display: flex;
  align-items: center;
  margin-bottom: 0.75rem;
  cursor: pointer;
  transition: color var(--transition);
}
.support-options li i {
  margin-right: 0.75rem;
  color: var(--primary);
}
.support-options li:hover {
  color: var(--accent);
}
.history-modal {
 max-height: 80vh;
 overflow-y: auto;
}
.quick-modal .btn-primary {
  margin-top: 1.5rem;
  padding: 0.75rem 2rem;
  font-size: 1rem;
  font-weight: 700;
  background: var(--primary);
  color: var(--white);
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}
.quick-modal .btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

.faq-section {
  background: var(--white);
  padding: 2rem var(--gap);
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
}
.faq-section h2 {
  margin-bottom: 1rem;
}
.accordion .accordion-item {
  margin-bottom: 1rem;
  border-radius: var(--radius);
  overflow: hidden;
}
.accordion-header {
  background: var(--light-bg);
  padding: 0.75rem 1rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  transition: background var(--transition);
}
.accordion-header:hover {
  background: var(--accent);
  color: var(--white);
}
.accordion-header i {
  transition: transform var(--transition);
}
.accordion-body {
  background: var(--white);
  padding: 1rem;
  border-left: 4px solid var(--accent);
  display: none;
  color: var(--dark-text);
  line-height: 1.4;
}
.accordion-body p {
  margin-bottom: 0.5rem;
}

.contact-section {
  background: var(--white);
  padding: 2rem var(--gap);
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
}
.contact-section h2 {
  margin-bottom: 1rem;
}
.contact-section p {
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  font-size: 1rem;
  color: var(--secondary);
}
.contact-section p i {
  margin-right: 0.75rem;
  color: var(--accent);
}
.social-icons {
  margin-top: 1rem;
}
.social-icons a {
  margin-right: 1rem;
  font-size: 1.5rem;
  color: var(--secondary);
  transition: color var(--transition), transform var(--transition);
}
.social-icons a:hover {
  color: var(--accent);
  transform: translateY(-2px);
}

.signin-overlay {
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.6);
  position: fixed;
  inset: 0;
  z-index: 2000;
}

.signin-modal {
  background: var(--white);
  padding: 2rem;
  border-radius: var(--radius);
  box-shadow: var(--shadow-dark);
  max-width: 400px;
  width: 90%;
  text-align: center;
}

.signin-modal h3 {
  font-family: var(--font-alt);
  margin-bottom: 1.5rem;
  font-size: 1.5rem;
  color: var(--secondary);
}

.signin-modal form .form-group {
  text-align: left;
  margin-bottom: 1rem;
}

.signin-modal form label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: var(--dark-text);
}

.signin-modal form input {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 1px solid #ccc;
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
  transition: border var(--transition), box-shadow var(--transition);
}

.signin-modal form input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(0,123,255,0.2);
}

.signin-modal form button {
  margin-top: 1rem;
  width: 100%;
  padding: 0.75rem;
  font-size: 1rem;
  font-weight: 600;
  color: var(--white);
  background: var(--primary);
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}

.signin-modal form button:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

.hero-content {
  position: relative;
  z-index: 3;
}

.hero-buttons {
  opacity: 0;
  animation: fadeInButtons 0.8s ease-out forwards 3s;
}

@keyframes fadeInButtons {
  from   { opacity: 0; transform: translateY(20px); }
  to     { opacity: 1; transform: translateY(0); }
}

.hero-buttons button {
  transform: translateY(20px);
  animation: slideUpBtn 0.8s ease-out forwards 3s;
}

@keyframes slideUpBtn {
  from   { transform: translateY(20px); }
  to     { transform: translateY(0); }
}

.bus-animations {
  position: absolute;
  bottom: -5%;    
  left: 50%;
  transform: translateX(-50%);
  z-index: 2;
}

.bus-animation {
  animation:
    busMove 4s ease-in-out infinite,
    pulseScale 2s ease-in-out infinite;
}

@keyframes pulseScale {
  0%, 100% { transform: scale(1); }
  50%      { transform: scale(1.1); }
}

    .hero-title {
  white-space: normal;
  font-size: 3rem;        
  line-height: 1.2;        
}

.hero-buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 1rem;
}

.hero-buttons button {
  padding: 0.75rem 1.5rem;
  font-weight: 600;
  font-size: 1rem;
  border-radius: var(--radius);
  border: none;
  cursor: pointer;
  box-shadow: var(--shadow-light);
  transition: background var(--transition), transform var(--transition);
}

.hero-buttons .btn-primary {
  background: var(--primary);
  color: var(--white);
}
.hero-buttons .btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

.hero-buttons .btn-secondary {
  background: var(--accent);
  color: var(--white);
}
.hero-buttons .btn-secondary:hover {
  background: #e65550;
  transform: translateY(-2px);
}

@media (max-width: 768px) {
  .hero-title {
    font-size: 2.5rem;
  }
  .hero-subtitle {
    font-size: 1rem;
  }
 .hero-buttons button { flex: none; width: auto; }
}
.support-options li a {
 color: var(--primary);
 text-decoration: none;
 font-weight: 600;
}
.support-options li a:hover {
 color: var(--accent);
}
     .chat-widget.hidden { display: none !important; }
.booking-section .form-group select,
.booking-section .form-group input {
  width: 100%;
  padding: 0.75rem 1rem;
  background: var(--white);
  border: 1px solid var(--muted-text);
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
  font-size: 1rem;
  transition: border var(--transition), box-shadow var(--transition);
}

.booking-section .form-group select:focus,
.booking-section .form-group input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(255,111,97,0.2);
}

.chat-widget {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 300px;
  max-height: 400px;
  background: var(--white);
  border: 1px solid #ddd;
  border-radius: var(--radius);
  box-shadow: var(--shadow-dark);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: transform var(--transition);
  transform: translateY(100%);
  z-index: 3000;
}

.chat-widget.visible {
  transform: translateY(0);
}

.chat-header {
  background: var(--primary);
  color: var(--white);
  padding: 0.5rem 1rem;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chat-close {
  background: none;
  border: none;
  color: var(--white);
  font-size: 1.2rem;
  cursor: pointer;
}

.chat-messages {
  flex: 1;
  padding: 0.75rem;
  overflow-y: auto;
}

.chat-messages .chat-user,
.chat-messages .chat-system {
  margin-bottom: 0.75rem;
  line-height: 1.4;
}

.chat-messages .chat-user {
  text-align: right;
  color: var(--white);
  background: var(--primary);
  display: inline-block;
  padding: 0.5rem 0.75rem;
  border-radius: var(--radius);
}
.view-map {
   display: block;
   margin: .75rem 0 0;
   padding: .5rem 1rem;
   background: var(--accent);
   color: var(--white);
   border: none;
   border-radius: var(--radius);
   font-size: .9rem;
   cursor: pointer;
   transition: background var(--transition), transform var(--transition);
 }
 .view-map:hover {
   background: #e6bd00;  
   transform: translateY(-2px);
 }
.chat-messages .chat-system {
  text-align: left;
  background: #f1f1f1;
  display: inline-block;
  padding: 0.5rem 0.75rem;
  border-radius: var(--radius);
}

.chat-input-area {
  display: flex;
  border-top: 1px solid #eee;
}

#chatInputField {
  flex: 1;
  border: none;
  padding: 0.75rem;
  font-size: 0.9rem;
}

#chatSendBtn {
  background: var(--accent);
  border: none;
  color: var(--white);
  padding: 0 1rem;
  cursor: pointer;
  transition: background var(--transition);
}

#chatSendBtn:hover {
  background: #e65550;
}

.info-sections {
  display: block;
  gap: var(--gap);
  margin: 4rem 0;
}

@media (min-width: 924px) {
  .info-sections {
    display: flex;
    justify-content: space-between;
  }
  .info-sections .faq-section,
  .info-sections .contact-section {
    flex: 1;
    max-width: calc(50% - var(--gap)/2);
  }
}

    .booking-confirm-modal .btn-primary[data-close="confirmModal"] {
  margin-top: 1.5rem;
  padding: 0.75rem 2rem;
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--white);
  background: var(--accent);
  border: none;
  border-radius: var(--radius);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  cursor: pointer;
  transition: background var(--transition), transform var(--transition);
}

.booking-confirm-modal .btn-primary[data-close="confirmModal"]:hover {
  background: #e65550;
  transform: translateY(-2px);
}

#rideDetail .export-icon {
  display: block;
  font-size: 1.5rem;
  color: var(--accent);
  margin: 1rem auto 0;
  cursor: pointer;
  transition: color var(--transition);
}
#rideDetail .export-icon:hover {
  color: var(--accent-dark, #e6bd00);
}

.bus-tracker {
  position: fixed; top: 80px; right: 0; bottom: 0;
  width: 300px; max-height: calc(100vh - 80px);
  background: var(--white); box-shadow: var(--shadow-dark);
  border-radius: var(--radius) 0 0 var(--radius);
  overflow-y: auto; transition: transform .3s;  z-index: 2500;   
}
.bus-tracker.hidden { transform: translateX(100%); }
.bus-tracker header {
  display: flex; justify-content: space-between;
  align-items: center; padding: .5rem 1rem;
  background: var(--secondary); color: var(--white);
  border-radius: var(--radius) 0 0 0;
}
.bus-tracker ul { list-style: none; margin:0; padding:0; }
.bus-tracker li {
  padding: .75rem 1rem; border-bottom:1px solid #eee;
  cursor: pointer; transition: background var(--transition);
}
.bus-tracker li:hover { background: var(--light-bg); }
#notifyToggle { width:100%; margin:1rem 0; }

    #closeTracker {
  background: none;
  border: none;
  color: var(--dark-text);
  font-size: 1.2rem;
  padding: 0.5rem;
  border-radius: var(--radius);
  transition: background var(--transition), color var(--transition);
 }
 #closeTracker:hover {
 background: var(--secondary);
  color: var(--white);
 }

 #notifyToggle {
  display: block;
  width: calc(100% - 2rem);
  margin: 1rem;
  padding: 0.75rem;
  font-size: 1rem;
  text-align: center;
  background: var(--accent);
  color: var(--white);
  border: none;
  border-radius: var(--radius);
  transition: background var(--transition), transform var(--transition);
 }
 #notifyToggle:hover {
  background: #e6bd00;
  transform: translateY(-2px);
 }

    .mobile-sidebar #openTrackerMobile {
  display: block;
  width: 100%;
  text-align: left;
  margin-top: 1rem;
}
 .ride-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.trash-btn {
  background: none;
  border: none;
  color: #dc3545;
  font-size: 1.1rem;
  cursor: pointer;
  transition: transform 0.2s;
}
.trash-btn:hover {
  transform: scale(1.2);
}

 #deleteConfirmModal .modal {
  max-width: 360px;
  text-align: center;
}
#deleteConfirmModal .modal-actions {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1.5rem;
}

    #deleteConfirmModal .modal-actions .btn-secondary {
  background: var(--light-bg);
  color: var(--secondary);
  padding: 0.6rem 1.2rem;
  border: 2px solid var(--secondary);
  border-radius: var(--radius);
  font-weight: 600;
  transition: background var(--transition), color var(--transition);
}
#deleteConfirmModal .modal-actions .btn-secondary:hover {
  background: var(--secondary);
  color: var(--white);
}

#deleteConfirmModal .modal-actions .btn-primary {
  background: var(--accent);
  color: var(--white);
  padding: 0.6rem 1.2rem;
  border: none;
  border-radius: var(--radius);
  font-weight: 700;
  transition: background var(--transition), transform var(--transition);
}
#deleteConfirmModal .modal-actions .btn-primary:hover {
  background: #e65550;
  transform: translateY(-2px);
}
    .eta-note {
  font-size: 0.9rem;
  color: var(--muted-text);
  margin: 0.25rem 0 1rem;
  text-align: center;
    }
    .ride-detail-modal {
  max-width: 360px;
  width: 90%;
  padding: 1.5rem;
  text-align: left;
}
.ride-detail-modal h3 {
  margin-bottom: 1rem;
  color: var(--secondary);
  font-family: var(--font-alt);
}
#rideDetailContent p {
  margin: 0.5rem 0;
}


#signOutMobile,
#signOutFooter {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background: none;
  border: none;
  color: var(--white);
  font-size: 1rem;
  cursor: pointer;
  transition: color var(--transition), background var(--transition);
}
#signOutMobile:hover,
#signOutFooter:hover {
  background: rgba(255,255,255,0.1);
  color: var(--accent);
}

.toast {
  position: fixed;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--secondary);
  color: var(--white);
  padding: 1rem 1.5rem;
  border-radius: var(--radius);
  box-shadow: var(--shadow-dark);
  opacity: 0;
  transition: transform 0.4s var(--transition), opacity 0.4s var(--transition);
  z-index: 9999;
}
.toast.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.bus-tracker header,
.bus-tracker #notifyToggle {
  position: sticky;
}
.bus-tracker #notifyToggle {
  margin: 0;
  border-radius: 0 0 var(--radius) var(--radius);
}

#exportRideBtn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 1.2rem;
  background: var(--primary);
  color: var(--white);
  border: none;
  border-radius: var(--radius);
  font-weight: 600;
  transition: background var(--transition), transform var(--transition);
  margin-top: 1rem;       
}
#exportRideBtn:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

    .modal-overlay#arModal {
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: none;
  background: rgba(0,0,0,0.8);
  z-index: 5000;
}
.modal#arModal .modal {
  position: relative;
}
#arCanvas {
  pointer-events: none;
}
#arModal .close-btn {
  position: absolute;
  top: 1rem; right: 1rem;
  font-size: 1.5rem;
}

    .fab-container {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  z-index: 4000;
}
.fab-btn {
  width: 64px; height: 64px;
  border-radius: 50%;
  background: var(--accent);
  color: var(--white);
  border: none;
  box-shadow: var(--shadow-dark);
  font-size: 1.5rem;
  cursor: pointer;
  transition: transform var(--transition), background var(--transition);
}
.fab-btn:hover {
  transform: scale(1.1);
}
.fab-menu {
  display: none;
  flex-direction: column-reverse;
  align-items: flex-end;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}
.fab-menu.open {
  display: flex;
}
.fab-item {
  width: 50px; height: 50px;
  border-radius: 50%;
  background: var(--primary);
  color: var(--white);
  border: none;
  box-shadow: var(--shadow-light);
  font-size: 1.25rem;
  cursor: pointer;
  transition: transform var(--transition), background var(--transition);
}
.fab-item:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}
    .ar-controls {
  position: absolute;
  bottom: 1rem;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 1rem;
  z-index: 6000;
}
.ar-controls button {
  background: rgba(0,0,0,0.6);
  color: #fff;
  border: none;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background var(--transition);
}
.ar-controls button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}
.ar-controls button:hover:enabled {
  background: rgba(0,0,0,0.8);
}
  </style>
</head>
<body>
  <aside id="busTracker" class="bus-tracker hidden">
    <header>
      <h3><i class="fas fa-shuttle-van"></i> Bus Tracker</h3><button id="closeTracker"><i class="fas fa-times"></i></button>
    </header>
    <ul id="trackerList"></ul>
    <button id="notifyToggle" class="btn-secondary">Enable ETA Alerts</button>
  </aside>
  <div class="signin-overlay" id="signinOverlay">
    <div class="modal signin-modal">
      <h3><i class="fas fa-user-lock"></i> Student Sign In</h3>
      <form id="signinForm">
        <div class="form-group">
          <label for="studentId">Student ID</label>
          <input type="text" id="studentId" placeholder="8‑digit ID" maxlength="8" required>
        </div>
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" placeholder="Letters only" pattern="[A-Za-z]+" required>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" placeholder="At least 6 chars" minlength="6" required>
        </div>
        <button type="submit" class="btn-primary">
          <i class="fas fa-sign-in-alt"></i> Sign In
        </button>
      </form>
    </div>
  </div>

 <header class="app-header">
    <div class="header-inner">
      <img src="knust1.png" alt="KNUST Logo" class="logo">
      <h1 class="app-title"> KNUST Shuttle Tracker</h1>
      <button class="hamburger" id="hamburgerBtn"><i class="fas fa-bars"></i></button>
      <nav class="header-nav desktop-only">
        <a href="#hero" class="nav-btn active"><i class="fas fa-home"></i> </a>
        <a href="#live-shuttles" class="nav-btn"><i class="fas fa-route"></i> </a>
        <a href="#book-ride" class="nav-btn"><i class="fas fa-paper-plane"></i> </a>
        <a href="#quick-book" class="nav-btn"><i class="fas fa-thumbs-up"></i> </a>
        <button class="nav-btn" id="ridesBtnHeader"><i class="fas fa-history"></i> My Rides</button>
      </nav>
    </div>
    <aside class="mobile-sidebar" id="mobileSidebar">
      <button class="close-sidebar" id="closeSidebar"><i class="fas fa-times"></i></button>
       <a href="#hero" class="nav-btn active"><i class="fas fa-home"></i> </a>
        <a href="#live-shuttles" class="nav-btn"><i class="fas fa-route"></i> </a>
        <a href="#book-ride" class="nav-btn"><i class="fas fa-paper-plane"></i> </a>
        <a href="#quick-book" class="nav-btn"><i class="fas fa-thumbs-up"></i> </a>
       <button id="openTrackerMobile" class="nav-btn"><i class="fas fa-shuttle-van"></i> Tracker</button>
   <button class="nav-btn" id="ridesBtnMobile"><i class="fas fa-history"></i> My Rides</button>
    </aside>
  </header>


  <section id="hero" class="hero-section">
    <div class="hero-background">
      <img src="shuttle.jpg" alt="Campus Shuttle Background">
      <div class="hero-overlay"></div>
    </div>
    <div class="hero-content">
      <h2 class="hero-title">Welcome to <span id="typewriter"></span></h2>
      <p class="hero-subtitle">Track, book and ride with confidence.</p>
      <div class="hero-buttons">
  <a href="#book-ride" class="btn-primary"><i class="fas fa-paper-plane"></i> Book a Ride</a>
  <a href="#live-shuttles" class="btn-secondary"><i class="fas fa-route"></i> See Live Shuttles</a>
      </div>
      <br>
      <div class="bus-animations">
        <div class="bus-animation bus-1"><i class="fas fa-shuttle-van"></i></div>
        <div class="bus-animation bus-2"><i class="fas fa-bus"></i></div>
        <div class="bus-animation bus-3"><i class="fas fa-bus-alt"></i></div>
      </div>
    </div>
  </section>

<br>
  <main class="container">

    <section id="live-shuttles" class="section live-section">
  <h2><i class="fas fa-route"></i> Live Shuttle Map & Status</h2>
 <p class="eta-note"><em>ETA means Estimated Time of Arrival</em></p>
  <div class="live-search">
   <input
    type="text"
    id="liveSearch"
    list="stop-list"
    placeholder="Choose a stop…"
    autocomplete="off"
  />
  <datalist id="stop-list">
    <option value="KSB">
    <option value="Medical Village">
    <option value="Brunei">
    <option value="Casely Hayeford">
    <option value="College of Science">
    <option value="Commercial Area">
  </datalist>
    <i class="fas fa-search search-icon"></i>
  </div>

  <div id="map" class="map-container"></div>

  <div id="liveCards" class="live-cards">
  </div>
</section>
<button class="btn-secondary" id="ridesBtnLive" style="display:none; margin:2rem auto;">
  <i class="fas fa-history"></i> My Rides
</button>
    <section id="book-ride" class="section booking-section">
      <h2><i class="fas fa-paper-plane"></i> Book Your Ride</h2>
      <form id="bookingForm">
        <div class="form-row">
          <div class="form-group">
            <label for="pickup"><i class="fas fa-location-arrow"></i> Pick‑Up</label>
            <select id="pickup" required>
              <option value="">Select pick‑up</option>
              <option value="KSB">KSB</option>
              <option value="Medical Village">Medical Village</option>
              <option value="Brunei">Brunei</option>
              <option value="Casely Hayeford">Casely Hayeford</option>
              <option value="College of Science">College of Science</option>
              <option value="Commercial Area">Commercial Area</option>
            </select>
          </div>
          <div class="form-group">
            <label for="destination"><i class="fas fa-flag-checkered"></i> Destination</label>
            <select id="destination" required>
              <option value="">Select destination</option>
              <option value="KSB">KSB</option>
              <option value="Medical Village">Medical Village</option>
              <option value="Brunei">Brunei</option>
              <option value="Casely Hayeford">Casely Hayeford</option>
              <option value="College of Science">College of Science</option>
              <option value="Commercial Area">Commercial Area</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="date"><i class="fas fa-calendar-alt"></i> Date</label>
            <input type="date" id="date" required>
          </div>
          <div class="form-group">
            <label for="timeslot"><i class="fas fa-clock"></i> Time Slot</label>
            <select id="timeslot" required>
              <option value="">Select time</option>
              <option>6:00 AM – 7:00 AM</option>
              <option>7:00 AM – 8:00 AM</option>
              <option>8:00 AM – 9:00 AM</option>
              <option>9:00 AM –10:00 AM</option>
              <option>10:00 AM –11:00 AM</option>
              <option>12:00 PM – 1:00 PM</option>
              <option>1:00 PM – 2:00 PM</option>
              <option>3:00 PM – 4:00 PM</option>
            </select>
          </div>
        </div>
        <button type="submit" class="btn-primary"><i class="fas fa-paper-plane"></i> Confirm Booking</button>
      </form>
    </section>

    <div class="history-buttons">
      <button id="prevRidesBtn" class="btn-secondary active"><i class="fas fa-archive"></i> Previous Rides</button>
      <button id="upcomingRidesBtn" class="btn-secondary"><i class="fas fa-clock"></i> Upcoming Rides</button>
      <button id="allRidesBtn" class="btn-secondary"><i class="fas fa-list"></i> All Rides</button>
    </div>


  <div class="modal-overlay" id="arModal">
    <div class="modal" style="max-width:100%; width:100%; height:100%; padding:0; background:transparent;">
     <button class="close-btn" data-close="arModal" style="color:#fff;"><i class="fas fa-times"></i></button>
      <video id="arVideo" autoplay muted playsinline style="width:100%; height:100%; object-fit:cover;"></video>
      <canvas id="arCanvas" style="position:absolute; top:0; left:0; width:100%; height:100%;"></canvas>
   <div class="ar-controls">
        <button id="startRecord"><i class="fas fa-circle"></i> Record</button>
        <button id="stopRecord" disabled><i class="fas fa-stop"></i> Stop</button>
      </div>
    </div>
  </div>
    
    <section id="quick-book" class="section quick-book-section">
      <h2><i class="fas fa-thumbs-up"></i> Quick Book Popular Stops</h2>
      <div class="grid-cards">
        <div class="card" data-page="ksbQuickModal">
          <img src="ksb.webp" alt="KSB">
          <div class="card-body"><p>KSB</p></div>
        </div>
        <div class="card" data-page="medicalQuickModal">
          <img src="medical.jpg" alt="Medical Village">
          <div class="card-body"><p>Medical Village</p></div>
        </div>
        <div class="card" data-page="bruneiQuickModal">
          <img src="brunei.jpeg" alt="Brunei">
          <div class="card-body"><p>Brunei</p></div>
        </div>
        <div class="card" data-page="caselyQuickModal">
          <img src="casely.jpg" alt="Casely Hayeford">
          <div class="card-body"><p>Casely Hayeford</p></div>
        </div>
        <div class="card" data-page="scienceQuickModal">
          <img src="science.jpg" alt="College of Science">
          <div class="card-body"><p>College of Science</p></div>
        </div>
        <div class="card" data-page="commerceQuickModal">
          <img src="commercial.jpg" alt="Commercial Area">
          <div class="card-body"><p>Commercial Area</p></div>
        </div>
      </div>
    </section>

  </main>
<div id="toastContainer"></div>

<div class="modal-overlay" id="historyModal">
  <div class="modal history-modal">
    <button class="close-btn" data-close="historyModal"><i class="fas fa-times"></i></button>
    <h3><i class="fas fa-history"></i> My Rides</h3>
    <div class="history-tabs">
      <button class="tab active" data-tab="prev">Previous</button>
      <button class="tab" data-tab="upcoming">Upcoming</button>
      <button class="tab" data-tab="all">All</button>
    </div>
    <ul class="ride-list" id="rideList">
    </ul>
    <div class="ride-detail" id="rideDetail">
      <p>Select a ride to view details.</p>
    </div>
  </div>
</div>

<div class="modal-overlay" id="rideDetailModal">
  <div class="modal ride-detail-modal">
    <button class="close-btn" data-close="rideDetailModal">
      <i class="fas fa-times"></i>
    </button>
    <h3><i class="fas fa-info-circle"></i> Ride Details</h3>
    <div id="rideDetailContent"></div>
     <button id="exportRideBtn" class="btn-secondary" style="margin-top:1rem;">
      <i class="fas fa-download"></i> Export PDF
    </button>
  </div>
</div>
  
  <div class="modal-overlay" id="ksbQuickModal">
    <div class="modal quick-modal">
      <button class="close-btn" data-close="ksbQuickModal"><i class="fas fa-times"></i></button>
      <h3><i class="fas fa-university"></i> Quick Book: KSB</h3>
      <p>Secure your seat on the next shuttle departing to/from KSB.</p>
  <a href="#book-ride" class="btn-primary"><i class="fas fa-paper-plane"></i> Book Now</a>
    </div>
  </div>
  <div class="modal-overlay" id="medicalQuickModal">
    <div class="modal quick-modal">
      <button class="close-btn" data-close="medicalQuickModal"><i class="fas fa-times"></i></button>
      <h3><i class="fas fa-hospital"></i> Quick Book: Medical Village</h3>
      <p>Reserve your spot for the next shuttle at Medical Village.</p>
  <a href="#book-ride" class="btn-primary"><i class="fas fa-paper-plane"></i> Book Now</a>
    </div>
  </div>
  <div class="modal-overlay" id="bruneiQuickModal">
    <div class="modal quick-modal">
      <button class="close-btn" data-close="bruneiQuickModal"><i class="fas fa-times"></i></button>
      <h3><i class="fas fa-tree"></i> Quick Book: Brunei</h3>
      <p>Get on the green route—book your Brunei shuttle now.</p>
 <a href="#book-ride" class="btn-primary"><i class="fas fa-paper-plane"></i> Book Now</a>
    </div>
  </div>
  <div class="modal-overlay" id="caselyQuickModal">
    <div class="modal quick-modal">
      <button class="close-btn" data-close="caselyQuickModal"><i class="fas fa-times"></i></button>
      <h3><i class="fas fa-university"></i> Quick Book: Casely Hayeford</h3>
      <p>Hop on the shuttle serving Casely Hayeford—reserve now.</p>
 <a href="#book-ride" class="btn-primary"><i class="fas fa-paper-plane"></i> Book Now</a>
    </div>
  </div>
  <div class="modal-overlay" id="scienceQuickModal">
    <div class="modal quick-modal">
      <button class="close-btn" data-close="scienceQuickModal"><i class="fas fa-times"></i></button>
      <h3><i class="fas fa-flask"></i> Quick Book: College of Science</h3>
      <p>Lock in your seat to/from the College of Science shuttle.</p>
 <a href="#book-ride" class="btn-primary"><i class="fas fa-paper-plane"></i> Book Now</a>
    </div>
  </div>
  <div class="modal-overlay" id="commerceQuickModal">
    <div class="modal quick-modal">
      <button class="close-btn" data-close="commerceQuickModal"><i class="fas fa-times"></i></button>
      <h3><i class="fas fa-shopping-bag"></i> Quick Book: Commercial Area</h3>
      <p>Secure your seat on the busy Commercial Area route.</p>
 <a href="#book-ride" class="btn-primary"><i class="fas fa-paper-plane"></i> Book Now</a>
    </div>
  </div>

<div class="info-sections">
    <section class="section faq-section" id="faq">
      <h2><i class="fas fa-question-circle"></i> FAQs</h2>
      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header"><i class="fas fa-chevron-down"></i> How do I cancel?</button>
          <div class="accordion-body">Tap the trash icon in “My Rides.”</div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header"><i class="fas fa-chevron-down"></i> Can I book for others?</button>
          <div class="accordion-body">Yes, enter their student ID in the form.</div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header"><i class="fas fa-chevron-down"></i> Weekend service?</button>
          <div class="accordion-body">Saturdays 7 AM–2 PM, no service Sundays.</div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header"><i class="fas fa-chevron-down"></i> Night shuttles?</button>
          <div class="accordion-body">8 PM–11 PM under “Late Rides.”</div>
        </div>
      </div>
    </section>

    <section class="section contact-section" id="contact">
      <h2><i class="fas fa-envelope"></i> Contact & Support</h2>
      <p><i class="fas fa-phone-alt"></i> +233 24 123 4567</p>
      <p><i class="fas fa-envelope-open-text"></i> support@knust-shuttle.app</p>
      <div class="social-icons">
        <a href="#"><i class="fab fa-facebook-square"></i></a>
        <a href="#"><i class="fab fa-twitter-square"></i></a>
        <a href="#"><i class="fab fa-instagram-square"></i></a>
        <a href="#"><i class="fab fa-linkedin"></i></a>
      </div>
    </section>
</div>
  </main>

<div class="modal-overlay" id="confirmModal">
  <div class="modal booking-confirm-modal">
    <button class="close-btn" data-close="confirmModal">
      <i class="fas fa-times"></i>
    </button>
    <h3><i class="fas fa-check-circle"></i> Booking Confirmed!</h3>
    <p>
      Your shuttle from
      <strong id="confPickup"></strong>
      to
      <strong id="confDestination"></strong>
      on
      <strong id="confDate"></strong>
      at
      <strong id="confTime"></strong>
      is now reserved.
    </p>
    <div class="qr-container">
      <canvas id="confirmQr"></canvas>
    </div>
    <p class="qr-note">
      You can always access this QR code later under <strong>My Rides</strong>.
    </p>
    <button class="btn-primary" data-close="confirmModal">
      <i class="fas fa-thumbs-up"></i> Great!
    </button>
  </div>
</div>

<div class="modal-overlay" id="supportModal">
  <div class="modal support-modal">
    <button class="close-btn" data-close="supportModal"><i class="fas fa-times"></i></button>
    <h3><i class="fas fa-headset"></i> Live Support</h3>
    <p>Hi there! 👋 How can we assist you today?</p>
    <ul class="support-options">
      <li>
    <i class="fas fa-question-circle"></i>
    <a href="faq.html" target="_blank">FAQ &amp; Help Center</a>
  </li>
  <li>
    <i class="fas fa-envelope"></i>
    <a href="mailto:support@knust-shuttle.app">Email Support</a>
  </li>
  <li>
    <i class="fas fa-phone-alt"></i>
    <a href="tel:+233241234567">Call Us</a>
  </li>
  <li>
    <i class="fas fa-comments"></i>
    <a href="#" id="chatAgentBtn">Chat with an Agent</a>
  </li>  
    </ul>
  </div>
</div>

  <div class="modal-overlay" id="deleteConfirmModal">
    <div class="modal">
      <button class="close-btn" data-close="deleteConfirmModal"><i class="fas fa-times"></i></button>
      <h3><i class="fas fa-exclamation-triangle"></i> Confirm Delete</h3>
      <p>Are you sure you want to remove this ride?</p>
      <div class="modal-actions">
        <button class="btn-secondary" data-close="deleteConfirmModal">Cancel</button>
        <button id="confirmDelete" class="btn-primary">Delete</button>
      </div>
    </div>
  </div>
  
<div id="chatWidget" class="chat-widget hidden">
  <div class="chat-header">
    <span>Live Chat</span>
    <button id="closeChatBtn" class="chat-close">&times;</button>
  </div>
  <div id="chatMessages" class="chat-messages">
    <div class="chat-system">Hi there! 👋 How can we help you today?</div>
  </div>
  <div class="chat-input-area">
    <input id="chatInputField" type="text" placeholder="Type your message…" />
    <button id="chatSendBtn">Send</button>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <footer class="app-footer">
    <p>&copy; 2025 KNUST Shuttle Tracker. Built with <i class="fas fa-heart"></i> by a KNUST Student</p>
 <button id="signOutFooter" type="button" class="btn-secondary" style="margin-top:1rem;">
    <i class="fas fa-sign-out-alt"></i> Sign Out
  </button>
  </footer>

<div class="fab-container">
    <button id="fabToggle" class="fab-btn"><i class="fas fa-th"></i></button>
    <div class="fab-menu">
      <button id="fab-ar"    class="fab-item" title="AR Stop Finder"><i class="fas fa-arrows-alt-v"></i></button>
      <button id="fab-notif" class="fab-item" title="Notifications"><i class="fas fa-bell"></i></button>
      <button id="fab-support" class="fab-item" title="Live Support"><i class="fas fa-headset"></i></button>
    </div>
  </div>

  <div class="modal-overlay" id="notifPrefsModal">
    <div class="modal quick-modal" style="max-width:360px;">
      <button class="close-btn" data-close="notifPrefsModal"><i class="fas fa-times"></i></button>
      <h3><i class="fas fa-bell"></i> Notification Preferences</h3>
      <form id="notifPrefsForm">
        <label><input type="checkbox" name="alert10" /> Alert 10 min before</label><br/>
        <label><input type="checkbox" name="alert5"  /> Alert 5 min before</label><br/>
        <label><input type="checkbox" name="alert2"  /> Alert 2 min before</label><br/>
        <label><input type="checkbox" name="lateWarn" /> Warn if >5 min late</label><br/>
        <button type="submit" class="btn-primary" style="margin-top:1rem;">Save Preferences</button>
      </form>
    </div>
  </div>
  
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.fullscreen/Control.FullScreen.min.js"></script>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.css"/>
<script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
  <script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
  
<script>

(function() {
  'use strict';

  function throttle(fn, wait) {
    let last = 0;
    return function(...args) {
      const now = Date.now();
      if (now - last >= wait) {
        last = now;
        fn.apply(this, args);
      }
    };
  }

  document.addEventListener('DOMContentLoaded', init);

  function init() {
    initSignIn();
    initHeroParallax();
    initTypewriter();
    initMap();
    initLiveShuttles();
    initBookingForm();
    initHistoryModal();
    initQuickBookCards();
    initSupportChat();
    initLiveChatWidget();
    initGlobalNav();
    startPeriodicUpdates();
    initCrowdHeatmap();
    initNotifPrefs(); 
    initARFinder();
    initFABMenu();
  }

  
  function initSignIn() {
    const overlay = document.getElementById('signinOverlay');
    const form    = document.getElementById('signinForm');

    if (localStorage.getItem('signedIn') === 'true') {
      overlay.style.display = 'none';
    } else {
      overlay.style.display = 'flex';
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      localStorage.setItem('signedIn', 'true');
      overlay.style.display = 'none';
    });
  }

 
  function initHeroParallax() {
    const hero       = document.querySelector('.hero-section');
    const bgImage    = hero.querySelector('.hero-background img');
    const busElems   = hero.querySelectorAll('.bus-animation');

    hero.addEventListener('mousemove', throttle(onMouseMove, 16));
    hero.addEventListener('mouseleave', onMouseLeave);

    function onMouseMove(e) {
      const r = hero.getBoundingClientRect();
      const x = ((e.clientX - r.left) / r.width  - 0.5) * 30;
      const y = ((e.clientY - r.top ) / r.height - 0.5) * 20;
      gsap.to(bgImage, { x, y, duration: 1, ease: 'power3.out' });
      busElems.forEach((bus, i) => {
        gsap.to(bus, {
          x: x * (1 + i * 0.5),
          y: y * (1 + i * 0.3),
          rotationY: x * 0.3,
          duration: 1,
          ease: 'power3.out'
        });
      });
    }

    function onMouseLeave() {
      gsap.to([bgImage, ...busElems], {
        x: 0, y: 0, rotationY: 0,
        duration: 1, ease: 'power3.out'
      });
    }
  }

 
  function initTypewriter() {
    const el    = document.getElementById('typewriter');
    const words = ['Your Campus Commute', 'The Smart Shuttle Tracker', 'KNUST Shuttle Tracker'];
    let wIdx = 0, cIdx = 0, forward = true;

    (function tick() {
      const current = words[wIdx];
      if (forward) {
        el.textContent = current.slice(0, ++cIdx);
        if (cIdx === current.length) {
          forward = false;
          setTimeout(tick, 1200);
          return;
        }
      } else {
        el.textContent = current.slice(0, --cIdx);
        if (cIdx === 0) {
          forward = true;
          wIdx = (wIdx + 1) % words.length;
        }
      }
      setTimeout(tick, forward ? 120 : 60);
    })();
  }

 
  let map, userMarker, shuttleMarkers, liveData, busObjects;
  const stops = {
    KSB: [6.669316, -1.567180],
    'Medical Village': [6.681115, -1.549788],
    Brunei: [6.670465, -1.574129],
    'Casely Hayeford': [6.675136, -1.567558],
    'College of Science': [6.674556, -1.567562],
    'Commercial Area': [6.682837, -1.576960]
  };
  const routes = {
    'KSB → Medical Village': ['KSB','Medical Village'],
    'Medical Village → Brunei': ['Medical Village','Brunei'],
    'Brunei → Commercial Area': ['Brunei','Commercial Area'],
    'Commercial Area → KSB': ['Commercial Area','KSB'],
    'Casely Hayeford → College of Science': ['Casely Hayeford','College of Science'],
    'College of Science → KSB': ['College of Science','KSB']
  };

  function initMap() {
    map = L.map('map', {
      zoomControl: false,
      fadeAnimation: true,
      markerZoomAnimation: true,
      zoomDelta: 0.25,
      inertia: true,
      fullscreenControl: true,
      fullscreenControlOptions: { position: 'topleft' }
      })
     .fitBounds(getCampusBounds());

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    L.control.zoom({ position: 'bottomright' }).addTo(map);
    L.control.scale({ position: 'bottomleft', metric: true, imperial: false }).addTo(map);
 L.control.locate({
      position: 'bottomright',
      strings: { title: 'Show my location' },
      flyTo: true,
      locateOptions: {
        enableHighAccuracy: false,
        maximumAge: 30000,
        timeout: 5000
      }
    }).addTo(map);
    L.rectangle(getCampusBounds(), { color:'#006233', weight:2, fillOpacity: 0.05 }).addTo(map);

     Object.entries(stops).forEach(([name, coord]) => {
      L.marker(coord).addTo(map).bindPopup(`<strong>${name}</strong>`);
    });

    const mini = new L.Control.MiniMap(
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
      { toggleDisplay: true, minimized: true }
    ).addTo(map);

     if ('geolocation' in navigator) {
      navigator.geolocation.watchPosition(onGeoSuccess, onGeoError, {
        enableHighAccuracy: true, maximumAge:10000, timeout:10000
      });
    }

    function onGeoSuccess(pos) {
      const latlng = [pos.coords.latitude, pos.coords.longitude];
      if (!userMarker) {
        userMarker = L.circleMarker(latlng, {
          radius: 8, color:'#3388ff', fillColor:'#3388ff', fillOpacity:1, className:'pulse-marker'
        }).addTo(map);
      } else {
        userMarker.setLatLng(latlng);
      }
    }

    function onGeoError(err) {
      console.warn('Geolocation error:', err);
    }
  }

  function getCampusBounds() {
    const lats = Object.values(stops).map(c => c[0]);
    const lons = Object.values(stops).map(c => c[1]);
    return [
      [Math.min(...lats), Math.min(...lons)],
      [Math.max(...lats), Math.max(...lons)]
    ];
  }

  
  function initLiveShuttles() {
    liveData = [
      { route:'KSB → Medical Village', eta:5, cap:30 },
      { route:'Brunei → Commercial Area', eta:2, cap:25 },
      { route:'Medical Village → Brunei', eta:8, cap:28 },
      { route:'Commercial Area → KSB', eta:12, cap:22 },
      { route:'Casely Hayeford → College of Science', eta:7, cap:35 },
      { route:'College of Science → KSB', eta:4, cap:32 }
    ];
    shuttleMarkers = L.layerGroup().addTo(map);
    busObjects = [];

    Object.entries(routes).forEach(([name, [from,to]], i) => {
      const start = stops[from], end = stops[to];
      const marker = L.marker(start, {
        icon: L.divIcon({ className:'bus-icon', html:'<i class="fas fa-shuttle-van"></i>' }),
        routeName: name
      }).addTo(map);
      busObjects.push({
        marker,
        from: L.latLng(start),
        to:   L.latLng(end),
        progress: Math.random(),
        speed: 0.0005 + Math.random()*0.0005
      });
    });

    renderLiveShuttles();
    document.getElementById('liveSearch').addEventListener('input', onSearchInput);
    document.addEventListener('click', onDocumentClick);
  }

  function onSearchInput(e) {
    const term = e.target.value.trim();
    if (stops[term]) {
      flyToStop(term);
    } else {
      renderLiveShuttles(term.toLowerCase());
    }
  }

  function flyToStop(name) {
    map.flyTo(stops[name], 17, { animate:true, duration:1.5 });
    L.popup().setLatLng(stops[name]).setContent(`<strong>${name}</strong>`).openOn(map);
  }

  function renderLiveShuttles(filter='') {
    const container = document.getElementById('liveCards');
    container.innerHTML = '';
    shuttleMarkers.clearLayers();
    liveData.forEach((item, i) => {
      if (filter && !item.route.toLowerCase().includes(filter)) return;
      const color = getRouteColor(i, item.eta);
      const occupancyPct = Math.round((40 - item.cap)/40*100);
      const div = document.createElement('div');
      div.className = 'shuttle-card';
      div.style.borderLeft = `4px solid ${color}`;
      div.innerHTML = `
        <h3 style="color:${color}">${item.route}</h3>
        <div class="occupancy">
          <span>Occupancy</span>
          <div class="occ-bar"><div class="occ-fill" style="width:${occupancyPct}%"></div></div>
        </div>
        <p><strong>ID:</strong> Bus-${i+101}</p>
        <p><strong>ETA:</strong> ${item.eta} min</p>
        <p><strong>Seats:</strong> ${item.cap}</p>
        <p class="updated"><small>Last updated: <span class="time">${new Date().toLocaleTimeString()}</span></small></p>
        <button class="view-map" data-route="${i}">View on map</button>
      `;
      div.style.animationDelay = `${i*0.1}s`;
      container.appendChild(div);

      const [from,to] = item.route.split(' → ');
      const mid = [
        (stops[from][0] + stops[to][0]) / 2,
        (stops[from][1] + stops[to][1]) / 2
      ];
      const pm = L.circleMarker(mid, {
        radius:12, color: getComputedStyle(document.documentElement).getPropertyValue('--accent'),
        fillColor: getComputedStyle(document.documentElement).getPropertyValue('--accent'),
        fillOpacity:0.7, className: 'pulse-marker'
      }).addTo(shuttleMarkers);
      pm.bindPopup(`${item.route}<br>ETA: ${item.eta} min`);
    });
  }

  function getRouteColor(i, eta) {
    if (eta <= 5) return '#dc3545';
    if (eta <= 10) return '#ffc107';
    return ['#007bff','#28a745','#17a2b8','#6f42c1'][i % 4];
  }

  function onDocumentClick(e) {
     const mobileNav = document.getElementById('mobileSidebar');
if (
      mobileNav.classList.contains('open') &&    
     !e.target.closest('#hamburgerBtn') &&
     !mobileNav.contains(e.target)
   ) {
    mobileNav.classList.remove('open');
    }
    handleTrackerOpenClose(e);
    if (e.target.matches('#ridesBtnHeader, #ridesBtnLive, #ridesBtnMobile')) {
      openHistory('all');
      e.preventDefault();
      e.stopPropagation();
    }
    if (e.target.closest('.view-map')) {
      const idx = +e.target.dataset.route;
      const item = liveData[idx];
      const [from,to] = item.route.split(' → ');
      const mid = [(stops[from][0]+stops[to][0])/2, (stops[from][1]+stops[to][1])/2];
      document.getElementById('map').scrollIntoView({ behavior:'smooth' });
      setTimeout(() => {
        map.invalidateSize();
        map.flyTo(mid,16,{ animate:true, duration:1});
        L.popup().setLatLng(mid).setContent(`${item.route}<br>ETA: ${item.eta} min`).openOn(map);
      }, 500);
    }
    if (e.target.matches('#closeChatBtn')) {
      document.getElementById('chatWidget').classList.add('hidden');
    }
    if (e.target.closest('[data-close="supportModal"]')) {
      document.getElementById('supportModal').style.display = 'none';
    }
    document.querySelectorAll('[data-close]').forEach(btn => {
      if (btn.contains(e.target)) {
        document.getElementById(btn.dataset.close).style.display = 'none';
      }
    });
  }

   let crowdHeatLayer;

  function initCrowdHeatmap() {
    crowdHeatLayer = L.heatLayer([], {
      radius: 25,    
      blur: 15,      
      maxZoom: 17,
      gradient: {
        0.2: 'lime',
        0.4: 'yellow',
        0.6: 'orange',
        0.8: 'red'
      }
    }).addTo(map);

    updateCrowdHeatmap();
    setInterval(updateCrowdHeatmap, 10000);
  }
  function updateCrowdHeatmap() {
    const mockCrowdData = [
      [6.669316, -1.567180, Math.random()],       // KSB
      [6.681115, -1.549788, Math.random()],       // Medical Village
      [6.670465, -1.574129, Math.random()],       // Brunei
      [6.675136, -1.567558, Math.random()],       // Casely Hayeford
      [6.674556, -1.567562, Math.random()],       // College of Science
      [6.682837, -1.576960, Math.random()]        // Commercial Area
    ];

   crowdHeatLayer.setLatLngs(mockCrowdData);
  }
  
 
  function handleTrackerOpenClose(e) {
    const tracker = document.getElementById('busTracker');
   if (e.target.matches('#openTracker, #openTrackerMobile')) {
      tracker.classList.remove('hidden');
      refreshTrackerList();
    } else if (!e.target.closest('#busTracker')) {
      tracker.classList.add('hidden');
    }
  }

function initFABMenu() {
  const toggle = document.getElementById('fabToggle');
  const menu   = document.querySelector('.fab-menu');
  const container = document.querySelector('.fab-container');

  container.addEventListener('click', e => e.stopPropagation());
  menu.addEventListener('click',      e => e.stopPropagation());

  toggle.addEventListener('click', e => {
    e.stopPropagation();            
       menu.classList.toggle('open');
  });

  document.getElementById('fab-ar').addEventListener('click', () => {
    document.getElementById('arModal').style.display = 'flex';
    menu.classList.remove('open');
  });

  document.getElementById('fab-notif').addEventListener('click', () => {
    document.getElementById('notifPrefsModal').style.display = 'flex';
    menu.classList.remove('open');
  });

  document.getElementById('fab-support').addEventListener('click', () => {
    document.getElementById('supportModal').classList.add('open');
    menu.classList.remove('open');
  });

   document.addEventListener('click', e => {
    if (menu.classList.contains('open') &&
        !toggle.contains(e.target) &&
        !menu.contains(e.target)) {
      menu.classList.remove('open');
    }
  });
}
  
  function initBookingForm() {
    const form    = document.getElementById('bookingForm');
    const modal   = document.getElementById('confirmModal');
    const qr      = new QRious({ element:document.getElementById('confirmQr'), size:200 });
    const confEls = {
      pickup:     document.getElementById('confPickup'),
      destination:document.getElementById('confDestination'),
      date:       document.getElementById('confDate'),
      time:       document.getElementById('confTime')
    };

    form.addEventListener('submit', e => {
      e.preventDefault();
      const p  = form.pickup.value;
      const d  = form.destination.value;
      const dt = form.date.value;
      const ts = form.timeslot.value;
      if (!p||!d||!dt||!ts||p===d) {
        alert('Please fill all fields and ensure pick‑up ≠ destination.');
        return;
      }
      const booking = { id:Date.now(), p,d,dt,ts };
      saveBooking(booking);
      confEls.pickup.textContent      = p;
      confEls.destination.textContent = d;
      confEls.date.textContent        = new Date(dt).toLocaleDateString();
      confEls.time.textContent        = ts;
      qr.value = JSON.stringify(booking);
      modal.style.display = 'flex';
      form.reset();
    });

    document.querySelectorAll('[data-close="confirmModal"]').forEach(btn => {
      btn.addEventListener('click', () => modal.style.display = 'none');
    });
  }

  function saveBooking(b) {
    const arr = JSON.parse(localStorage.getItem('ksbBookings')||'[]');
    arr.push(b);
    localStorage.setItem('ksbBookings', JSON.stringify(arr));
  }


  function initHistoryModal() {
    const historyModal = document.getElementById('historyModal');
    const rideList     = document.getElementById('rideList');
    const rideDetail   = document.getElementById('rideDetailContent');
    const tabs         = Array.from(document.querySelectorAll('.history-tabs .tab'));
    let filter = 'all';

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        filter = tab.dataset.tab;
        renderHistory(filter);
      });
    });

    rideList.addEventListener('click', e => {
      if (e.target.closest('.trash-btn')) {
        openDeleteConfirm(e.target.closest('li').dataset.id);
        return;
      }
      const li = e.target.closest('li');
      if (!li) return;
      rideList.querySelectorAll('li').forEach(x=>x.classList.remove('active'));
      li.classList.add('active');
      const booking = getBookingById(li.dataset.id);
      renderRideDetail(booking);
    });

    document.getElementById('confirmDelete').addEventListener('click', () => {
      const modal = document.getElementById('deleteConfirmModal');
      const toDel = modal.dataset.toDelete;
      deleteBooking(toDel);
      renderHistory(filter);
      modal.style.display = 'none';
    });

    document.querySelectorAll('[data-close="deleteConfirmModal"]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('deleteConfirmModal').style.display = 'none';
      });
    });
  }

  function openHistory(f) {
    renderHistory(f);
    document.getElementById('historyModal').style.display = 'flex';
  }

  function getBookingById(id) {
    const arr = JSON.parse(localStorage.getItem('ksbBookings')||'[]');
    return arr.find(b=>b.id==id);
  }

  function renderHistory(filter) {
    const rideList   = document.getElementById('rideList');
    const tabs       = document.querySelectorAll('.history-tabs .tab');
    const all        = JSON.parse(localStorage.getItem('ksbBookings')||'[]');
    const todayStr   = new Date().toISOString().split('T')[0];
    let filtered;

    if (filter==='prev') {
      filtered = all.filter(b=>b.dt < todayStr);
    } else if (filter==='upcoming') {
      filtered = all.filter(b=>b.dt >= todayStr);
    } else {
      filtered = all;
    }

    tabs.forEach(t=> t.classList.toggle('active', t.dataset.tab===filter));
    rideList.innerHTML = '';
    if (!filtered.length) {
      rideList.innerHTML = '<li>No rides found.</li>';
      return;
    }
    filtered.forEach(b => {
      const li = document.createElement('li');
      li.dataset.id = b.id;
      li.innerHTML = `
        <span>${b.p} → ${b.d} — ${b.dt} @ ${b.ts}</span>
        ${filter!=='prev'?'<button class="trash-btn" data-id="'+b.id+'"><i class="fas fa-trash"></i></button>':''}
      `;
      rideList.appendChild(li);
    });
  }

  function renderRideDetail(b) {
    const container = document.getElementById('rideDetailContent');
    container.innerHTML = `
      <h4>${b.p} → ${b.d}</h4>
      <p><strong>Date:</strong> ${b.dt}</p>
      <p><strong>Time:</strong> ${b.ts}</p>
      <div class="qr-container"><canvas id="rideQrSmall"></canvas></div>
    `;
    new QRious({ element: document.getElementById('rideQrSmall'), size:150, value: JSON.stringify(b) });
    document.getElementById('rideDetailModal').style.display = 'flex';
  }

  function deleteBooking(id) {
    let arr = JSON.parse(localStorage.getItem('ksbBookings')||'[]');
    arr = arr.filter(b=>b.id != id);
    localStorage.setItem('ksbBookings', JSON.stringify(arr));
  }

  function initARFinder() {
  const btn    = document.getElementById('arBtn');
  const modal  = document.getElementById('arModal');
  const video  = document.getElementById('arVideo');
  const canvas = document.getElementById('arCanvas');
  const ctx    = canvas.getContext('2d');
  const stopsArr = Object.entries(stops).map(([name, coord]) => ({ name, lat:coord[0], lng:coord[1] }));

  btn.addEventListener('click', async () => {
    modal.style.display = 'flex';
    const stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:'environment' } });
    video.srcObject = stream;
    let mediaRecorder, recordedChunks = [];
    document.getElementById('startRecord').disabled = false;
    document.getElementById('stopRecord').disabled  = true;

    document.getElementById('startRecord').onclick = () => {
      recordedChunks = [];
      mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm; codecs=vp9' });
      mediaRecorder.ondataavailable = e => { if (e.data.size) recordedChunks.push(e.data); };
      mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: 'video/webm' });
        const url  = URL.createObjectURL(blob);
        const a    = document.createElement('a');
        a.href     = url;
        a.download = `AR_capture_${Date.now()}.webm`;
        a.click();
        URL.revokeObjectURL(url);
      };
      mediaRecorder.start();
      document.getElementById('startRecord').disabled = true;
      document.getElementById('stopRecord').disabled  = false;
    };

    document.getElementById('stopRecord').onclick = () => {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        document.getElementById('stopRecord').disabled  = true;
        document.getElementById('startRecord').disabled = false;
      }
    };
   canvas.width  = video.clientWidth;
    canvas.height = video.clientHeight;
    navigator.geolocation.getCurrentPosition(pos => {
      const userLat = pos.coords.latitude, userLng = pos.coords.longitude;
      window.addEventListener('deviceorientationabsolute', e => {
        drawAR(e.alpha, userLat, userLng);
      });
    });
  });

  modal.querySelector('[data-close="arModal"]').addEventListener('click', () => {
    modal.style.display = 'none';
    const tracks = video.srcObject?.getTracks()||[];
    tracks.forEach(t=>t.stop());
    ctx.clearRect(0,0,canvas.width,canvas.height);
  });

  function drawAR(alpha, uLat, uLng) {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    stopsArr.forEach(s => {
      const bearing = getBearing(uLat,uLng,s.lat,s.lng);
      let rel = bearing - alpha;
      if (rel < -180) rel += 360;
      if (rel > 180)  rel -= 360;
      if (Math.abs(rel) < 30) {
        const x = canvas.width * (0.5 + rel/60);
        const dist = getDistance(uLat,uLng,s.lat,s.lng).toFixed(1);
        ctx.fillStyle = 'yellow';
        ctx.font = 'bold 18px sans-serif';
        ctx.fillText(`${s.name} — ${dist} km`, x, canvas.height*0.2);
      }
    });
  }

  function getDistance(lat1,lon1,lat2,lon2){
    const R=6371, dLat=(lat2-lat1)*Math.PI/180, dLon=(lon2-lon1)*Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)
            * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  }
  function getBearing(lat1,lon1,lat2,lon2) {
    const φ1=lat1*Math.PI/180, φ2=lat2*Math.PI/180;
    const Δλ=(lon2-lon1)*Math.PI/180;
    const y=Math.sin(Δλ)*Math.cos(φ2);
    const x=Math.cos(φ1)*Math.sin(φ2)
            - Math.sin(φ1)*Math.cos(φ2)*Math.cos(Δλ);
    return (Math.atan2(y,x)*180/Math.PI+360)%360;
  }
}

  function initQuickBookCards() {
    document.querySelectorAll('.card[data-page]').forEach(card => {
      const modal = document.getElementById(card.dataset.page);
      card.addEventListener('click', () => modal.style.display = 'flex');
    });

    document.querySelectorAll('.quick-modal a.btn-primary').forEach(btn => {
      btn.addEventListener('click', e => {
        const overlay = e.target.closest('.modal').parentElement;
        overlay.style.display = 'none';
      });
    });
  }


  function initSupportChat() {
    const btn    = document.getElementById('supportChat');
    const modal  = document.getElementById('supportModal');
    const agent  = document.getElementById('chatAgentBtn');
 btn.addEventListener('click', () => {
      modal.classList.add('open');
    });
    modal.addEventListener('click', e => {
      if (e.target===modal) modal.style.display = 'none';
    });
    agent.addEventListener('click', e => {
      e.preventDefault();
       modal.classList.remove('open');
      const widget = document.getElementById('chatWidget');
      widget.classList.remove('hidden');
      widget.classList.add('visible');
    });
  }

   function openDeleteConfirm(id) {
   const modal = document.getElementById('deleteConfirmModal');
    modal.dataset.toDelete = id;
    modal.style.display = 'flex';
  }

   document.getElementById('exportRideBtn').addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit:'pt', format:'letter' });
    const content = document.getElementById('rideDetailContent');
    doc.html(content, {
      callback: pdf => {
        pdf.setFontSize(12);
        pdf.text('KNUST Shuttle Tracker – Ride Details', 40, 40);
        pdf.save(`ride_${Date.now()}.pdf`);
      },
      x: 40,
      y: 60,
      html2canvas: { scale: 0.8 }
    });
  });
 
  function initLiveChatWidget() {
    const sendBtn = document.getElementById('chatSendBtn');
    const input   = document.getElementById('chatInputField');
    const messages= document.getElementById('chatMessages');

    sendBtn.addEventListener('click', onSend);
    input.addEventListener('keydown', e => {
      if (e.key==='Enter') { e.preventDefault(); onSend(); }
    });

    function onSend() {
      const text = input.value.trim();
      if (!text) return;
      appendChat(text, true);
      input.value = '';
      setTimeout(() => {
        appendChat('Thanks for your message! An agent will be with you shortly.', false);
      }, 1000);
    }

    function appendChat(txt, isUser) {
      const div = document.createElement('div');
      div.className = isUser ? 'chat-user' : 'chat-system';
      div.textContent = txt;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }
  }

  function initNotifPrefs() {
  const btn   = document.getElementById('notifPrefsBtn');
  const modal = document.getElementById('notifPrefsModal');
  const form  = document.getElementById('notifPrefsForm');

  btn.addEventListener('click', () => modal.style.display = 'flex');
  modal.querySelectorAll('[data-close]').forEach(x =>
    x.addEventListener('click', () => modal.style.display = 'none')
  );

  const saved = JSON.parse(localStorage.getItem('notifPrefs')||'{}');
  Object.keys(saved).forEach(k => {
    const inp = form.querySelector(`[name="${k}"]`);
    if (inp) inp.checked = saved[k];
  });

  form.addEventListener('submit', e => {
    e.preventDefault();
    const prefs = {};
    ['alert10','alert5','alert2','lateWarn'].forEach(key => {
      prefs[key] = !!form.elements[key].checked;
    });
    localStorage.setItem('notifPrefs', JSON.stringify(prefs));
    showToast('Notification preferences saved!');
    modal.style.display = 'none';
  });
}
  
  
  function initGlobalNav() {
     const sidebar = document.getElementById('mobileSidebar');
sidebar.addEventListener('click', e => e.stopPropagation());
   document.getElementById('hamburgerBtn').addEventListener('click', e => {
   e.stopPropagation();              
    document.getElementById('mobileSidebar').classList.add('open');
  });
  document.getElementById('closeSidebar').addEventListener('click', () => {
    sidebar.classList.remove('open');
  });
    document.querySelectorAll('.nav-btn[href^="#"]').forEach(btn => {
      btn.addEventListener('click', e => {
        e.preventDefault();
        const id = btn.getAttribute('href').substring(1);
        const headerH = document.querySelector('.app-header').offsetHeight;
        document.getElementById(id).scrollIntoView({ behavior:'smooth' });
        window.scrollBy(0, -headerH);
      });
    });
  }

 
  function startPeriodicUpdates() {
    setInterval(() => {
      liveData.forEach(item => {
        item.eta = Math.max(1, item.eta - 1);
        item.cap = Math.max(0, item.cap - Math.floor(Math.random()*2));
      });
      renderLiveShuttles(document.getElementById('liveSearch').value.trim().toLowerCase());
      updateLiveCardsUI();
      refreshTrackerList();
      scheduleAllSmartAlerts(); 
    }, 10000);

    setInterval(() => {
      busObjects.forEach(bus => {
        bus.progress = (bus.progress + bus.speed) % 1;
        const lat = bus.from.lat + (bus.to.lat - bus.from.lat)*bus.progress;
        const lng = bus.from.lng + (bus.to.lng - bus.from.lng)*bus.progress;
        bus.marker.setLatLng([lat, lng]);
        const rem = Math.ceil((1-bus.progress)*15);
        bus.marker.getPopup().setContent(`<strong>${bus.marker.options.routeName}</strong><br/>ETA: ${rem} min`);
      });
    }, 1000);
  }

  function updateLiveCardsUI() {
    document.querySelectorAll('.shuttle-card').forEach((card,i) => {
      const item = liveData[i];
      card.querySelector('.time').textContent = new Date().toLocaleTimeString();
      const pct = Math.round((40-item.cap)/40*100);
      card.querySelector('.occ-fill').style.width = pct + '%';
      const color = getRouteColor(i, item.eta);
      card.style.borderLeft = `4px solid ${color}`;
      card.querySelector('h3').style.color = color;
    });
  }

  function scheduleAllSmartAlerts() {
  const prefs = JSON.parse(localStorage.getItem('notifPrefs')||'{}');
  liveData.forEach((bus,i) => {
    const eta = bus.eta;
    ['alert10','alert5','alert2'].forEach(key => {
      const minutes = parseInt(key.replace('alert',''),10);
      if (prefs[key] && eta > minutes) {
        scheduleSmartAlert(i, eta, minutes);
      }
    });
    if (prefs.lateWarn && eta > 5) {
      scheduleSmartAlert(i, eta, -1); 
    }
  });
}

const alertTimers = {};
function scheduleSmartAlert(idx, eta, offset) {
  const bus   = liveData[idx];
  const idKey = `${idx}_${offset}`;
  if (alertTimers[idKey]) return; 
  let delay;
  if (offset > 0) {
    delay = (eta - offset) * 60 * 1000;
  } else {
    delay = 5 * 60 * 1000; 
  }

  alertTimers[idKey] = setTimeout(() => {
    const title = offset>0
      ? `⏱️ ${bus.route} in ${offset} min`
      : `⚠️ ${bus.route} running late`;
    new Notification(title, {
      body: offset>0
        ? `Your shuttle will arrive in ${offset} minutes.`
        : `ETA is ${bus.eta} min.`,
      actions: [{action:'snooze', title:'Snooze'}]
    });
    delete alertTimers[idKey];
  }, delay);
}
  

  function refreshTrackerList() {
    const notifyToggle = document.getElementById('notifyToggle');
    const enabled      = notifyToggle.textContent.includes('Disable');
    const listEl       = document.getElementById('trackerList');
    listEl.innerHTML   = '';
    liveData.forEach((bus,i) => {
      const li = document.createElement('li');
      li.innerHTML = `<strong>${bus.route}</strong><br/>ETA: ${bus.eta} min • Seats: ${bus.cap}`;
      li.addEventListener('click', () => {
        const b = busObjects[i];
        const lat = b.from.lat + (b.to.lat - b.from.lat)*b.progress;
        const lng = b.from.lng + (b.to.lng - b.from.lng)*b.progress;
        map.flyTo([lat,lng],16,{animate:true,duration:1});
        document.getElementById('busTracker').classList.add('hidden');
      });
      listEl.appendChild(li);
      if (enabled && bus.eta <= 2) {
        new Notification(`${bus.route} arriving in ${bus.eta} min`);
      }
    });
  }

  document.getElementById('notifyToggle').addEventListener('click', async function() {
    const btn = this;
    if (btn.textContent.includes('Enable')) {
      const perm = await Notification.requestPermission();
      if (perm==='granted') {
        btn.textContent = 'Disable ETA Alerts';
        showToast('ETA Alerts Enabled');
      } else {
        showToast('Notifications Denied');
      }
    } else {
      btn.textContent = 'Enable ETA Alerts';
      showToast('ETA Alerts Disabled');
    }
  });

 
  function showToast(msg) {
    const t = document.createElement('div');
    t.className = 'toast';
    t.textContent = msg;
    document.getElementById('toastContainer').appendChild(t);
    requestAnimationFrame(()=> t.classList.add('show'));
    setTimeout(()=> {
      t.classList.remove('show');
      t.addEventListener('transitionend', ()=> t.remove(), {once:true});
    }, 3000);
  }


  (function addTrackerHeaderButton() {
    const headerNav = document.querySelector('.header-nav');
    if (!document.getElementById('openTracker')) {
      const btn = document.createElement('button');
      btn.id = 'openTracker';
      btn.className = 'nav-btn desktop-only';
      btn.innerHTML = '<i class="fas fa-shuttle-van"></i> Tracker';
      headerNav.appendChild(btn);
      btn.addEventListener('click', () => {
        document.getElementById('busTracker').classList.remove('hidden');
      });
    }
  })();

  (function wireHistoryButtons() {
    ['prevRidesBtn','upcomingRidesBtn','allRidesBtn'].forEach(id => {
      const btn = document.getElementById(id);
      if (btn) {
        btn.addEventListener('click', e => {
          e.preventDefault();
          const mode = id === 'prevRidesBtn'
            ? 'prev'
            : id === 'upcomingRidesBtn'
              ? 'upcoming'
              : 'all';
          renderHistory(mode);
          document.getElementById('historyModal').style.display = 'flex';
          document.querySelectorAll('.history-buttons .btn-secondary').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      }
    });
  })();

  (function initAccordion() {
    document.querySelectorAll('.accordion-header').forEach(header => {
      header.addEventListener('click', () => {
        const body = header.nextElementSibling;
        const icon = header.querySelector('i.fa-chevron-down');
        if (body.style.display === 'block') {
          body.style.display = 'none';
          icon.style.transform = '';
        } else {
          body.style.display = 'block';
          icon.style.transform = 'rotate(180deg)';
        }
      });
    });
  })();

 
  (function reInitQuickBookCards() {
    document.querySelectorAll('.card[data-page]').forEach(card => {
      const modal = document.getElementById(card.dataset.page);
      card.removeEventListener('click', null);
      card.addEventListener('click', () => {
        if (modal) modal.style.display = 'flex';
      });
    });
  })();


})();
</script>



</body>
</html>
